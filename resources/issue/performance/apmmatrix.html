<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600667 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="8657"/>

<div>
<span><div><div><br/></div><div><span style="font-size: 14pt;">接入方法</span></div><div><font style="font-size: 14pt;"><br/></font></div><hr/><div><br/></div><ul><li><div><span style="font-size: 14pt;">在你项目根目录下的 gradle.properties 中配置要依赖的 Matrix 版本号，如：</span></div></li></ul><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>MATRIX_VERSION=0.4.10</div></div><div style="margin-left: 40px;"><font style="font-size: 14pt;"><br/></font></div><ul><li><div><span style="font-size: 14pt;">在你项目根目录下的 build.gradle 文件添加 Matrix 依赖，如：</span></div></li></ul><div style="margin-left: 80px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>dependencies {</div><div>      classpath (&quot;com.tencent.matrix:matrix-gradle-plugin:${MATRIX_VERSION}&quot;) { changing = true }</div><div>  }</div></div><div style="margin-left: 80px;"><br/></div><div style="margin-left: 80px;"></div><ul><li><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(36, 41, 46); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 14pt;">在 app/build.gradle 文件中添加 Matrix 配置插件和Bughunter依赖，如：</span></span></div></li></ul><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div>dependencies {</div><div>    compile fileTree(include: ['*.jar'], dir: 'libs')</div><div>    compile('com.xiaopeng.lib:lib_bughunter:1.4.0-matrix-SNAPSHOT') {</div><div>        changing = true</div><div>    }</div><div>}</div><div><br/></div><div>apply plugin: 'com.tencent.matrix-plugin'</div><div>  matrix {</div><div>    trace {</div><div>        enable = true   </div><div>        baseMethodMapFile = &quot;${project.buildDir}/matrix_output/Debug.methodmap&quot;</div><div>        blackListFile = &quot;${project.projectDir}/matrixTrace/blackMethodList.txt&quot;</div><div>    }</div><div><br/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><br/></div><div><br/></div></div><div style="margin-left: 40px;"><br/></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;">Demo  地址</span></div><div><span style="font-size: 12pt;"><br/></span></div><hr/><div><br/></div><div><br/></div><div><a href="http://gitlab.xiaopeng.local:18080/tangyong/caton">http://gitlab.xiaopeng.local:18080/tangyong/caton</a></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt;">输出得卡顿日志格式</span></div><div><font style="font-size: 14pt;"><br/></font></div><hr/><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div><br/></div><div>tag[</div><div>  Trace_EvilMethod</div><div>]type[</div><div>  null</div><div>];key[</div><div>  null</div><div>];content[</div><div>  {</div><div>    &quot;process&quot;: &quot;com.example.weijj.catontest&quot;,    //包名,</div><div>    &quot;stackKey&quot;: &quot;12\n&quot;,                          // 关键卡顿函数 </div><div>    &quot;time&quot;: 1555644231966,                       // 执行时间</div><div>    &quot;detail&quot;: &quot;NORMAL&quot;,                          //</div><div>    &quot;tag&quot;: &quot;Trace_EvilMethod&quot;,                   // 慢函数</div><div>    &quot;subType&quot;: -1,                               // 默认 -1</div><div>    &quot;mem&quot;: 1846677504,                           // 内存</div><div>    &quot;cpu_app&quot;: 8.525233879496181E-4,             //CPU使用</div><div>    &quot;stack&quot;: &quot; 0,com.example.weijj.catontest.MainActivity mainThread (Landroid.view.View;)V,1,1280\n1,com.example.weijj.catontest.MainActivity decode ()V,1,1280\n&quot;,   //卡顿堆栈</div><div>    &quot;machine&quot;: &quot;MIDDLE&quot;, </div><div>    &quot;cost&quot;: 1288,                                 //卡顿时间</div><div>    &quot;mem_free&quot;: 141132                            // 甚于内存</div><div>  }</div><div>]</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt;">原理差异对比</span></div><div><br/></div><hr/><div><br/></div><div><br/></div><div><img src="apmmatrix_files/process_hunter.bmp" type="image/bmp" data-filename="process_hunter.bmp"/></div><div><br/></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><ul><li><div><span style="font-size: 14pt;">lib_hunter 拿到主线程的Stack.</span></div></li></ul><div style="margin-left: 80px;"><br/></div><div style="margin-left: 80px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div><br/></div><div>  /**</div><div>     * 收集主线程堆栈信息</div><div>     *</div><div>     * @return 堆栈信息</div><div>     */</div><div>    private StackTraceElement[] getMainThreadStackInfo() {</div><div>        if (mMainThread == null) {</div><div>            mMainThread = Looper.getMainLooper().getThread();</div><div>        }</div><div>        return mMainThread.getStackTrace();</div><div>     }</div><div>  </div><div><br/></div><div><br/></div></div></div><div style="margin-left: 80px;"><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;">  </span></div><div><span style="font-size: 14pt;">  </span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><div><br/></div><div><span style="font-size: 14pt;">性能对比</span></div><hr/><div><br/></div></div><div><a href="https://github.com/Tencent/matrix/wiki/Matrix-Android-TraceCanary">https://github.com/Tencent/matrix/wiki/Matrix-Android-TraceCanary</a></div><div><br/></div><div><br/></div><div><br/></div><div><img src="apmmatrix_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div></span>
</div></body></html> 