<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600553 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7748"/>

<div>
<span><div><div><br/></div><div><br/></div><div><span style="font-size: 16pt;">编写目的</span></div><ul><ul><li><div><span style="font-size: 12pt;">解决个应用之间弹出窗口相互掩盖,相互之间无法通讯的问题.</span></div></li></ul></ul><div><br/></div><div><br/></div><div><span style="font-size: 16pt;">文档范围</span></div><ul><ul><li><div><span style="font-size: 12pt;">此文档之定义个应用之间弹出窗口达到互斥的规则.</span></div></li></ul></ul><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 16pt;">实现原理</span></div><div style="margin-left: 40px;"><span style="font-size: 16pt;">            </span></div><div style="margin-left: 40px;"><span style="font-size: 14pt;">IPC See More detail : </span></div><div style="margin-left: 40px;"><a href="http://doc.xiaopeng.local:18090/pages/viewpage.action?pageId=20153439">http://doc.xiaopeng.local:18090/pages/viewpage.action?pageId=20153439</a></div><div><span style="font-size: 16pt;">                    </span></div><div style="margin-left: 120px;"><img src="hc_files/WindowManager.bmp" type="image/bmp" data-filename="WindowManager.bmp" width="868"/></div><div style="margin-left: 120px;"><br/></div><div style="margin-left: 120px;"><br/></div><div style="margin-left: 40px;"><img src="hc_files/str.png" type="image/png" data-filename="str.png"/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><ul><li><div><span style="font-size: 14pt;"> IOnWindowIPCListener </span></div></li><ul><li><div><span style="font-size: 12pt;">客户端需要实现的接口</span></div></li><ul><li><div><span style="font-size: 14pt;">IOnWindowIPCListener.</span><span style="font-size: 14pt;">onWindowIPCEvent(boolean flag , String sender)</span></div></li><ul><li><div><span style="font-size: 12pt;">flag 标识 true表示打开 false表示关闭</span></div></li><li><div><span style="font-size: 12pt;">Sender 表示发送者包名</span></div></li></ul></ul></ul><li><div><span style="font-size: 12pt;">MainActivity</span></div></li><ul><li><div><span style="font-size: 12pt;">这里代表客户端程序</span></div></li></ul><li><div><span style="font-size: 14pt;">XwindowIPCImpl</span></div></li><ul><li><div><span style="font-size: 12pt;">封装了EventBus注册,以及IPC发送消息的过程,客户端无需感知</span></div></li></ul></ul><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 14.6667px;"><br/></span></div><div><span style="font-size: 16pt;">目前互斥应用范围 [</span><span style="font-size: 10pt;">范围是指现在或者将来需要这项能力</span><span style="font-size: 16pt;">]</span></div><div><br/></div><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col><col style="width: 336px;"></col><col style="width: 207px;"></col><col style="width: 207px;"></col></colgroup><tbody><tr><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div>序号</div></td><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">应用名</span></div></td><td style="vertical-align: middle; width: 336px; padding: 8px; border: 1px solid;">包名</td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div>时间</div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">1</span></div></td><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div>空调</div></td><td style="vertical-align: middle; width: 336px; padding: 8px; border: 1px solid;"><div><span style="font-size: 16pt;">com.android.systemui</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">2019/1/31</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">2</span></div></td><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">AI助手</span></div></td><td style="vertical-align: middle; width: 336px; padding: 8px; border: 1px solid;"><div><span style="font-size: 16pt;">com.xiaopeng.aiassistant</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">2019/1/31</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">3</span></div></td><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">自动泊车</span></div></td><td style="vertical-align: middle; width: 336px; padding: 8px; border: 1px solid;"><div><span style="font-size: 16pt;">com.xiaopeng.autopilot</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">2019/1/31</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">4</span></div></td><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">充电</span></div></td><td style="vertical-align: middle; width: 336px; padding: 8px; border: 1px solid;"><div><span style="font-size: 16pt;">com.xiaopeng.chargecontrol</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">2019/1/31</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">5</span></div></td><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">车控</span></div></td><td style="vertical-align: middle; width: 336px; padding: 8px; border: 1px solid;"><div><span style="font-size: 16pt;">com.xiaopeng.carcontrol</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><span style="font-size: 12pt;">2019/1/31</span></div></td><td style="vertical-align: middle; width: 207px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr></tbody></table><div><br/></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt;">接入步骤</span></div><ul><li><div><span style="font-size: 14pt;">依赖libxui</span></div></li></ul><div><span style="font-size: 14pt;"><br/></span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(169, 183, 198); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">dependencies {</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(169, 183, 198); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">implementation</span> <span style="color: rgb(106, 135, 89); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">'com.android.support.constraint:constraint-layout:1.1.3'</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(169, 183, 198); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">implementation</span> <span style="color: rgb(106, 135, 89); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">'com.xiaopeng.lib:lib_xui:0.2.0-tyipc-SNAPSHOT'</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><br/></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><br/></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">//Demo</span><span style="color: rgb(128, 128, 128); font-family: 宋体; font-size: 10.8pt;">应用</span><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">aar</span><span style="color: rgb(128, 128, 128); font-family: 宋体; font-size: 10.8pt;">方式</span><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">,</span><span style="color: rgb(128, 128, 128); font-family: 宋体; font-size: 10.8pt;">正式接入会用</span><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">maven</span><span style="color: rgb(128, 128, 128); font-family: 宋体; font-size: 10.8pt;">库</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">/*</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">implementation &quot;com.android.support:appcompat-v7:${rootProject.ext.supportLibVersion}&quot;</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">implementation 'com.android.support.constraint:constraint-layout:1.1.3'</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">implementation 'com.xiaopeng.lib.framework:ipcmodule:1.0.1'</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">implementation 'com.xiaopeng.lib:lib_theme_switch:1.2.4'</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">implementation files('libs/lib_xui-debug.aar')</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(128, 128, 128); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">*/</span></div><div style="background-color: rgb(43, 43, 43); font-size: 10.8pt;"><span style="color: rgb(169, 183, 198); font-family: &quot;Courier New&quot;; font-size: 10.8pt;">}</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><ul><li><div><span style="font-size: 14pt;">完成XUI的初始化[</span><span style="font-size: 14pt;">可在应用启动时完成</span><span style="font-size: 14pt;">]</span></div></li></ul><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@Override</div><div>    protected void onCreate(Bundle savedInstanceState) {</div><div>        super.onCreate(savedInstanceState);</div><div>        XUI.init(getApplicationContext());</div><div>        setContentView(R.layout.activity_main);</div><div>        </div><div>}</div></div></div><ul><li><div><span style="font-size: 14pt;">实现IOnWindIPCLIstener.接口方法完成相应逻辑</span></div></li></ul><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>/**</div><div>     * @param flag   窗口打开还是关闭</div><div>     * @param sender 消息发送者包名</div><div>     */</div><div>    public void onWindowIPCEvent(boolean flag, String sender) {</div><div>        //</div><div>        Log.i(&quot;tyler.tang&quot;, &quot;IPC one from &quot; + sender);</div><div>    }</div><div><br/></div><div><br/></div></div></div><ul><li><div><span style="font-size: 16pt;">注册需要实现的监听</span></div></li></ul><div style="margin-left: 40px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>  XWindowIPCImpl ipc = new XWindowIPCImpl();</div><div>  ipc.register(IOnWindIPCLIstener);</div></div></div><ul><li><div><span style="font-size: 16pt;">窗口show出来时调用方法通知其他应用</span></div></li></ul><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>   XWindowUtil.notifyAllWindow(true, &quot;com.sny.ipcone&quot;);</div></div></div><ul><li><div><span style="font-size: 14pt;">窗口关闭时时调用方法通知其他应用</span></div></li></ul><div style="margin-left: 40px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>XWindowUtil.notifyAllWindow(false, &quot;com.sny.ipcone&quot;);</div></div><div><br/></div></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><span style="font-size: 14pt;">客户端接入源码Demo</span></div><div style="margin-left: 40px;"><font style="font-size: 14pt;"><br/></font></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><a href="hc_files/ipcclienttwo.rar"><img src="hc_files/369683cd1bd5da199859479221b5621d.png" alt="ipcclienttwo.rar"></a></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><a href="hc_files/ipcone.rar"><img src="hc_files/8e5bd8c0f01527e63fbb58da0d19f46a.png" alt="ipcone.rar"></a></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><span style="font-size: 14pt;">客户端测试Demo</span></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><a href="hc_files/ipc-one.apk"><img src="hc_files/2ee1226a1c54e2d83d590a6909af8e6f.png" alt="ipc-one.apk"></a></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><a href="hc_files/ipc-two.apk"><img src="hc_files/f7343c932f249d4f339c2b26f4358277.png" alt="ipc-two.apk"></a></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><span style="font-size: 14pt;">测试方法</span></div><ul><ul><li><div><span style="font-size: 12pt;">安装测试程序.</span></div></li><li><div><span style="font-size: 12pt;">分别打开两应用.</span></div></li><li><div>点击第一个程序弹出窗口</div></li><li><div>切换到第二哥程序,打开窗口</div></li><li><div>这个时候,先打开的就能收到后面打开的消息</div></li></ul></ul><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>10-31 20:14:44.890 23541-23541/com.sny.ipcone I/tyler.tang: onEvent</div><div>10-31 20:14:44.890 23541-23541/com.sny.ipcone I/tyler.tang: from com.sny.ipctwomsg is :true</div></div><div><br/></div><div><br/></div><div style="margin-left: 120px;"><br/></div><div style="margin-left: 40px;"><span style="font-size: 14pt;"><br/></span></div><div style="margin-left: 40px;"><span style="font-size: 14pt;"><br/></span></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 120px;"><br/></div><div><br/></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;"><br/></span></div><div style="margin-left: 40px;"><br/></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div style="margin-left: 80px;"><br/></div></div><div><br/></div></span>
</div></body></html> 